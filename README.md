# Парсер строительных смесей с сайта maxidom

## Описание проекта

Этот проект представляет собой веб-приложение на базе FastAPI, которое реализует CRUD-операции для работы с продуктами и использует WebSocket для реального времени уведомлений о действиях с продуктами. Приложение также поддерживает асинхронный парсинг данных с сайта с использованием `aiohttp` и `BeautifulSoup`.

### Основные функции:
- **CRUD-операции**: создание, чтение и удаление продуктов из базы данных.
- **WebSocket**: уведомления для клиентов о добавлении и удалении продуктов в реальном времени.
- **Парсинг продуктов**: асинхронный парсер для получения списка продуктов с сайта и сохранения их в базу данных.
- **База данных**: SQLite с использованием SQLAlchemy для асинхронных операций.

## Структура проекта

### **Backend**
- **FastAPI** — основа для реализации API.
- **SQLAlchemy** (с поддержкой асинхронных операций через `asyncpg` и `aiomysql`) — используется для работы с базой данных.
- **WebSocket** — для получения уведомлений в реальном времени.
- **`aiohttp` и `BeautifulSoup`** — для асинхронного парсинга данных с внешнего сайта.

## Установка

### 1. Клонировать репозиторий
```bash
git clone https://github.com/EmuTheGreat/WebApi.git
cd WebApi
```

### 2. Установка зависимостей:

```bash
pip install -r requirements.txt
```

### 3. Запуск приложения:
```bash
cd source/
uvicorn main:app --reload
```

### 4. Доступ к Swagger UI:

Перейдите в браузере по адресу:
<http://127.0.0.1:8000/docs>

---

## API эндпоинты:

### WebSocket:
- **`/ws`**  
  Подключение для получения уведомлений в реальном времени.

### Парсинг данных:
- **`POST /parse/`**  
  Запускает процесс парсинга продуктов с сайта и сохраняет их в базу данных. После завершения парсинга отправляется уведомление всем подключённым пользователям через WebSocket.

### Получение данных:
- **`GET /products/`**  
  Возвращает список всех продуктов. Можно использовать параметры skip и limit для пагинации (по умолчанию: skip=0, limit=10).
- **`GET /products/{product_id}`** 
  Возвращает данные о продукте по указанному ID.

### Создание данных:
- **`POST /products/`**  
  Создаёт новый продукт в базе данных. Требуется передать название и цену продукта в теле запроса.

### Удаление данных:
- **`DELETE /products/{product_id}`**  
  Удаляет продукт из базы данных по указанному ID. Возвращает сообщение об успешном удалении или ошибку, если продукт не найден.

---

## Уведомления через WebSocket:

Подключение к WebSocket на примере javascript:

```javascript
const socket = new WebSocket("ws://127.0.0.1:8000/ws");

socket.onopen = () => {
    console.log("Соединение установлено");
};

socket.onmessage = (event) => {
    console.log("Уведомление:", event.data);
};

socket.onclose = () => {
    console.log("Соединение закрыто");
};
```
